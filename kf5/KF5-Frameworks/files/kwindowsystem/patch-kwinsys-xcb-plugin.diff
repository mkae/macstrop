diff --git CMakeLists.txt CMakeLists.txt
index b9d7d98..a7d6c8d 100644
--- CMakeLists.txt
+++ CMakeLists.txt
@@ -43,9 +43,9 @@ if(WIN32)
    find_package(Qt5WinExtras REQUIRED)
 endif()
 
-if (NOT APPLE)
-    find_package(X11)
-endif()
+#if (NOT APPLE)
+    find_package(X11 REQUIRED)
+#endif()
 
 set(KWINDOWSYSTEM_HAVE_X11 ${X11_FOUND})
 
diff --git src/CMakeLists.txt src/CMakeLists.txt
index 1598b4f..33f045b 100644
--- src/CMakeLists.txt
+++ src/CMakeLists.txt
@@ -19,29 +19,30 @@ set(kwindowsystem_SRCS
     ${kwindowsystem_QM_LOADER}
     )
 
-if (KWINDOWSYSTEM_HAVE_X11)
-  set(kwindowsystem_SRCS ${kwindowsystem_SRCS}
-    platforms/xcb/kselectionowner.cpp
-    platforms/xcb/kselectionwatcher.cpp
-    platforms/xcb/kxerrorhandler.cpp
-    platforms/xcb/kxutils.cpp
-  )
-endif()
+# if (KWINDOWSYSTEM_HAVE_X11)
+#   set(kwindowsystem_SRCS ${kwindowsystem_SRCS}
+#     platforms/xcb/kselectionowner.cpp
+#     platforms/xcb/kselectionwatcher.cpp
+#     platforms/xcb/kxerrorhandler.cpp
+#     platforms/xcb/kxutils.cpp
+#   )
+# endif()
 
 set(platformLinkLibraries)
 
 if (KWINDOWSYSTEM_HAVE_X11)
    include_directories(${CMAKE_CURRENT_SOURCE_DIR}/platforms/xcb)
+   include_directories(${Qt5X11Extras_INCLUDE_DIRS})
    if(NOT X11_Xrender_LIB)
       message(FATAL_ERROR "The XRender library could not be found. Please install the development package for it.")
    endif()
    if(NOT X11_Xfixes_LIB)
       message(FATAL_ERROR "The XFixes library could not be found. Please install the development package for it.")
    endif()
-   set(platformLinkLibraries Qt5::X11Extras ${X11_LIBRARIES} ${X11_Xfixes_LIB} ${X11_Xrender_LIB} ${XCB_XCB_LIBRARY} ${XCB_KEYSYMS_LIBRARY})
-   set(kwindowsystem_SRCS ${kwindowsystem_SRCS} platforms/xcb/kkeyserver.cpp
-                                                platforms/xcb/kxmessages.cpp
-                                                platforms/xcb/netwm.cpp )
+#    set(platformLinkLibraries Qt5::X11Extras ${X11_LIBRARIES} ${X11_Xfixes_LIB} ${X11_Xrender_LIB} ${XCB_XCB_LIBRARY} ${XCB_KEYSYMS_LIBRARY})
+#    set(kwindowsystem_SRCS ${kwindowsystem_SRCS} platforms/xcb/kkeyserver.cpp
+#                                                 platforms/xcb/kxmessages.cpp
+#                                                 platforms/xcb/netwm.cpp )
 endif ()
 
 if (APPLE)
@@ -78,12 +79,12 @@ target_link_libraries(KF5WindowSystem
     PRIVATE ${platformLinkLibraries}
 )
 
-if(KWINDOWSYSTEM_HAVE_X11)
-    # we install kkeyserver_x11.h which needs the X11 headers available
-    # if we don't add the include path here code that includes kkeyserver.h will fail
-    # to compile unless X11 is installed in /usr/include
-    target_include_directories(KF5WindowSystem PUBLIC ${XCB_XCB_INCLUDE_DIR} ${X11_X11_INCLUDE_PATH})
-endif()
+# if(KWINDOWSYSTEM_HAVE_X11)
+#     # we install kkeyserver_x11.h which needs the X11 headers available
+#     # if we don't add the include path here code that includes kkeyserver.h will fail
+#     # to compile unless X11 is installed in /usr/include
+#     target_include_directories(KF5WindowSystem PUBLIC ${XCB_XCB_INCLUDE_DIR} ${X11_X11_INCLUDE_PATH})
+# endif()
 
 if(IS_ABSOLUTE "${KDE_INSTALL_INCLUDEDIR_KF5}")
   target_include_directories(KF5WindowSystem INTERFACE "$<INSTALL_INTERFACE:${KDE_INSTALL_INCLUDEDIR_KF5}>" )
diff --git src/config-kwindowsystem.h.cmake src/config-kwindowsystem.h.cmake
index 9692b35e29265847da6fe948e518f613760867cc..039ed5f77fb82d4f9318bdb812ebf69675f9c06a 100644
--- src/config-kwindowsystem.h.cmake
+++ src/config-kwindowsystem.h.cmake
@@ -1,5 +1,6 @@
 /* config-kwindowsystem.h. Generated by cmake from config-kwindowsystem.h.cmake */
 
+#ifndef KWINDOWSYSTEM_HAVE_X11
 /* Define to 1 if you have the Xlib */
 #cmakedefine01 KWINDOWSYSTEM_HAVE_X11
 
@@ -8,6 +9,13 @@
 
 /* Define to 1 if you have the Xrender library */
 #cmakedefine01 KWINDOWSYSTEM_HAVE_XRENDER
+#elif KWINDOWSYSTEM_HAVE_X11
+// XQuartz has XFixes and XRender, period.
+#undef KWINDOWSYSTEM_HAVE_XFIXES
+#define KWINDOWSYSTEM_HAVE_XFIXES true
+#undef KWINDOWSYSTEM_HAVE_XRENDER
+#define KWINDOWSYSTEM_HAVE_XRENDER true
+#endif
 
 /* Path to xcb plugin */
 #define XCB_PLUGIN_PATH "${KDE_INSTALL_FULL_PLUGINDIR}/kf5/org.kde.kwindowsystem.platforms/KF5WindowSystemX11Plugin.so"
diff --git src/platforms/xcb/CMakeLists.txt src/platforms/xcb/CMakeLists.txt
index 4a6ee1d..b26372c 100644
--- src/platforms/xcb/CMakeLists.txt
+++ src/platforms/xcb/CMakeLists.txt
@@ -5,6 +5,7 @@ set(xcb_plugin_SRCS
     kxerrorhandler.cpp
     kxutils.cpp
     plugin.cpp
+    netwm.cpp
 )
 
 add_library(KF5WindowSystemX11Plugin MODULE ${xcb_plugin_SRCS})
--- autotests/orig.CMakeLists.txt	2016-03-23 21:42:24.000000000 +0100
+++ autotests/CMakeLists.txt	2016-03-23 21:31:58.000000000 +0100
@@ -11,6 +11,8 @@
 if (NOT APPLE)
     find_package(X11)
     find_package(XCB COMPONENTS XCB)
+else()
+    unset(X11_FOUND)
 endif()
 
 macro(KWINDOWSYSTEM_UNIT_TESTS)
diff --git src/kstartupinfo.cpp src/kstartupinfo.cpp
index 1be0595..cefd57e 100644
--- src/kstartupinfo.cpp
+++ src/kstartupinfo.cpp
@@ -43,6 +43,8 @@ DEALINGS IN THE SOFTWARE.
 
 #include <config-kwindowsystem.h> // KWINDOWSYSTEM_HAVE_X11
 
+#define KWINDOWSYSTEM_HAVE_X11 0
+
 // need to resolve INT32(qglobal.h)<>INT32(Xlibint.h) conflict
 #ifndef QT_CLEAN_NAMESPACE
 #define QT_CLEAN_NAMESPACE
diff --git src/kusertimestamp.cpp src/kusertimestamp.cpp
index ff1b5fc..9c89bee 100644
--- src/kusertimestamp.cpp
+++ src/kusertimestamp.cpp
@@ -20,6 +20,8 @@
 #include "config-kwindowsystem.h"
 #include <QGuiApplication>
 
+#define KWINDOWSYSTEM_HAVE_X11 0
+
 #if KWINDOWSYSTEM_HAVE_X11
 #include <netwm.h>
 #include <QX11Info>
diff --git tests/CMakeLists.txt tests/CMakeLists.txt
index c0865d9..776e7fb 100644
--- tests/CMakeLists.txt
+++ tests/CMakeLists.txt
@@ -20,7 +20,7 @@ kwindowsystem_executable_tests(
   backgroundcontrasttest
 )
 
-if(KWINDOWSYSTEM_HAVE_X11)
+if(KWINDOWSYSTEM_HAVE_X11 AND NOT APPLE)
     kwindowsystem_executable_tests(icontest)
     target_link_libraries(icontest Qt5::X11Extras)
 endif()
diff --git src/kwindowsystem.cpp src/kwindowsystem.cpp
index fda1682..9fcb1c8 100644
--- src/kwindowsystem.cpp
+++ src/kwindowsystem.cpp
@@ -716,7 +721,7 @@ QPoint KWindowSystem::constrainViewportRelativePosition(const QPoint &pos)
 static inline KWindowSystem::Platform initPlatform()
 {
 #if KWINDOWSYSTEM_HAVE_X11
-    if (QX11Info::isPlatformX11()) {
+    if (QGuiApplication::platformName().startsWith(QLatin1String("xcb"), Qt::CaseInsensitive)) {
         return KWindowSystem::Platform::X11;
     }
 #endif
